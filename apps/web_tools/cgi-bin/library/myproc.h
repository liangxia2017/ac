#ifndef _MYPROC_H
#define _MYPROC_H
#include <netinet/in.h>
#include <sys/socket.h>
#include "dbinterface.h"
#include "postdata.h"
#include "prop.h"

#define DB_FILE "/opt/config/ac_model.db"

#define DB_ERROR 0
#define DB_OK 1

#define MAX_SQL_LEN 200

#define NTP_AP_CONFIG 1
#define NTP_AC_CONFIG 2

#define MAX_AP_PER_G   100
#define MAX_AP_POLICY 100
#define MAX_WLAN_ITEM 20
#define MAX_WLAN_SECURITY 10
#define MAX_RADIUS_CONFIG 10
#define MAX_NTP_CONFIG 10
#define MAX_DOWNLOAD_CONFIG 10
#define MAX_AS_CONFIG 2
#define MAX_SNMP_CONFIG 10
#define MAX_VERSION_INFO 100
#define MAX_HOTBAK_CONFIG 10
#define MAX_NTP_SERVER_CONFIG 5
#define MAX_NTP_CLIENT_CONFIG 5
#define MAX_ROUTE_CONFIG 5
#define MAX_SYSLOG_CONFIG 5
#define MAX_NET_INFO 10
#define MAX_MAC_FILTER 20
#define MAX_RADIO_BASE 5
#define MAX_RADIO_ADVANCE 5
#define MAX_CHAN_CONFIG 5
#define MAX_SCAN_CONFIG 5
#define MAX_LOAD_BALANCE 5
#define MAX_CAPWAP_TIMER_CONFIG 5
//################DDL################

//AP组操作语句
#define INSERT_AP_GROUP_INFO "INSERT INTO AP_GROUP (AP_GROUP_NAME,AP_GROUP_DESC) VALUES(:nStr,:dStr)"
#define QUERY_AP_GROUP_INFO "SELECT AP_GROUP_ID,AP_GROUP_NAME,RADIO_STATUS,AP_GROUP_DESC FROM AP_GROUP"
#define DELETE_AP_GROUP_INFO "DELETE FROM AP_GROUP WHERE AP_GROUP_ID = :id"
#define UPDATE_AP_GROUP_STATUS "UPDATE AP_GROUP SET RADIO_STATUS = :radio_status WHERE AP_GROUP_ID = :id"
#define QUERY_AP_GROUP_ACCORD_POLICY_GID "SELECT AP_GROUP_ID,AP_GROUP_NAME,RADIO_STATUS,AP_GROUP_DESC FROM AP_GROUP WHERE AP_GROUP_ID IN ( SELECT AP_GROUP_ID FROM AP_WLAN_POLICY WHERE POLICY_GROUP_ID = :id)"

//WLAN组操作语句
#define INSERT_WLAN_GROUP_INFO "INSERT INTO WLAN_GROUP (WLAN_GROUP_NAME,WLAN_GROUP_DESC) VALUES (:nStr,:dStr)"
#define QUERY_WLAN_GROUP_INFO "SELECT WLAN_GROUP_ID,WLAN_GROUP_NAME,WLAN_GROUP_DESC"
#define DELETE_WLAN_GROUP_INFO "DELETE FROM WLAN_GROUP WHERE WLAN_GROUP_ID=:id"
//AP操作语句
#define INSERT_AP_ITEM "INSERT INTO AP_ITEM (MAC,AP_GROUP_ID,AP_NAME) VALUES (:mac,:gid,:name)"
#define QUERY_AP_ITEM "SELECT AP_ID,MAC,AP_GROUP_ID,AP_NAME FROM AP_ITEM"
#define DELETE_AP_ITEM "DELETE FROM AP_ITEM WHERE AP_ID = :id"
#define QUERY_AP_ITEM_MAC "SELECT AP_ITEM_ID,MAC,IP,AP_GROUP_ID, AP_NAME,AP_DESC,LOCATION,ONLINE_TIME,START_TIME, AP_STATUS,RADIO_COUNT FROM AP_ITEM WHERE MAC = :mac"
#define UPDATE_AP_ITEM_MAC "UPDATE AP_ITEM SET IP = :ip, START_TIME = CURRENT_TIMESTAMP,VERSION_INFO_ID=:id,AP_STATUS=:sta,RADIO_COUNT = :radio_count WHERE MAC = :mac"

#define QUERY_AP_ITEM_COUNT_MAC "SELECT COUNT(*) FROM AP_ITEM WHERE MAC = :mac "
#define QUERY_AP_ITEM_GID "SELECT * FROM AP_ITEM WHERE AP_GROUP_ID = :gid  and ap_status = 1"

#define QUERY_WLAN_USER_MODE "SELECT USER_MODE FROM WLAN_ITEM WHERE WLAN_ITEM_ID =:id AND WLAN_GROUP_ID IN (SELECT WLAN_GROUP_ID FROM AP_WLAN_POLICY WHERE AP_GROUP_ID IN (SELECT AP_GROUP_ID FROM AP_ITEM WHERE MAC = :mac))"
//非法AP操作语句
#define INSERT_INVALID_AP_ITEM "INSERT INTO INVALID_AP_ITEM (MAC,BSSID,SSID,RADIO_ID,CHANNEL,SINGLE,SNR,RATE,AP_TYPE) VALUES (:mac,:bssid,:ssid,:radio_id,:channel,:single,:snr,:rate,:ap_type)"
#define INSERT_NO_GROUP_AP_ITEM "INSERT INTO AP_ITEM (MAC,AP_GROUP_ID,ONLINE_TIME) VALUES (:mac,1,CURRENT_TIMESTAMP)"

#define UPDATE_INVALID_AP_SWITCH "UPDATE INVALID_AP_SWITCH SET SWITCH_FLAG = :flag;"
#define GET_INVALID_AP_SWITCH "SELECT SWITCH_FLAG FROM INVALID_AP_SWITCH "

//AP时间策略操作语句
#define QUERY_AP_POLICY_GID "SELECT C.POLICY_ITEM_ID,C.POLICY_GROUP_ID,C.POLICY_NAME, C.POLICY_TYPE,C.IS_ALL_DAY,C.START_HOUR,C.START_MIN,C.END_HOUR, C.END_MIN,C.WEEK_INDEX,C.MONTH_INDEX,C.DAY_INDEX FROM AP_ITEM A,AP_WLAN_POLICY B,POLICY_ITEM C WHERE A.AP_GROUP_ID = B.AP_GROUP_ID AND B.POLICY_GROUP_ID = C.POLICY_GROUP_ID AND A.AP_GROUP_ID = :gid"
#define QUERY_AP_POLICY_ITEM "SELECT * FROM POLICY_ITEM WHERE POLICY_GROUP_ID IN (SELECT POLICY_GROUP_ID FROM AP_WLAN_POLICY) "
//WLAN操作语句
#define INSERT_WLAN_CONFIG_ITEM "INSERT INTO WLAN_CONFIG_ITEM (WLAN_GROUP_ID,WLAN_SECURITY_POLICY_ID,SSID,BROADCAST_SSID,VLAN,QOS,MAX_USER,MAC_FILTER_POLICY) VALUES (:gid,:sid,:ssid,:bssid,:vlan,:qos,:max_user,:mac_filter_policy) "
#define QUERY_WLAN_CONFIG_ITEM "SELECT WLAN_CONFIG_ITEM_ID,WLAN_GROUP_ID,WLAN_SECURITY_POLICY_ID,SSID,BROADCAST_SSID,VLAN,QOS,MAX_USER,MAC_FILTER_POLICY FROM WLAN_CONFIG_ITEM"
#define DELETE_WLAN_CONFIG_ITEM "DELETE FROM WLAN_CONFIG_ITEM WHERE WLAN_CONFIG_ITEM_ID = :id"
#define QUERY_WLAN_ITEM_APGID "SELECT * FROM WLAN_ITEM WHERE WLAN_GROUP_ID IN (SELECT WLAN_GROUP_ID FROM AP_WLAN_POLICY WHERE AP_GROUP_ID = :gid ) "
//WLAN安全策略操作语句
#define INSERT_WLAN_SECURITY_POLICY "INSERT INTO WLAN_SECURITY_POLICY (NAME,MODE,AUTH_MODE,KEY_LEN,KEY_TYPE,ENCRYPT_TYPE,DEFAULT_KEY_INDEX,KEY1,KEY2,KEY3,KEY4) VALUES (:name,:mode,:auth_mode,:key_len,:key_type,:encrypt_type,:default_key_index,:key1,:key2,:key3,:key4)"
#define QUERY_WLAN_SECURITY_POLICY "SELECT WLAN_SECURITY_POLICY_ID,NAME,SECURITY_MODE,AUTH_MODE,  KEY_LEN,KEY_TYPE,ENCRYPT_TYPE,DEFAULT_KEY_INDEX,KEY1,KEY2,KEY3,KEY4,PSK_KEY FROM WLAN_SECURITY_POLICY  WHERE WLAN_SECURITY_POLICY_ID = :id"

#define DELETE_WLAN_SECURITY_POLICY "DELETE FROM WLAN_SECURITY_POLICY WHERE WLAN_SECURITY_POLICY_ID = :id"
//###################################

//RADIUS配置操作语句
#define INSERT_RADIUS_CONFIG "INSERT INTO RADIUS_CONFIG (AUTH_IP,ACCOUNT_IP) VALUES (:auth_ip,:account_ip)"
#define QUERY_RADIUS_CONFIG "SELECT ID,AUTH_TYPE,AUTH_LEVEL,IP,PORT,PWD FROM RADIUS_CONFIG"
#define DELETE_RADIUS_CONFIG "DELETE FROM RADIUS_CONFIG WHERE ID = :id"
#define UPDATE_RADIUS_CONFIG "UPDATE RADIUS_CONFIG SET AUTH_IP = :auth_ip,ACCOUNT_IP = :account_ip where id = :id "
//NTP配置操作语句
#define INSERT_NTP_CONFIG "INSERT INFO NTP_CONFIG (SWITCH_FLAG,IP) VALUES (:switch_flag,:ip)"
#define QUERY_NTP_CONFIG "SELECT ID,SWITCH_FLAG,IP FROM NTP_CONFIG"
#define DELETE_NTP_CONFIG "DELETE FROM NTP_CONFIG WHERE ID = :id"
#define UPDATE_NTP_CONFIG "UPDATE NTP_CONFIG SET SWITCH_FLAG = :switch_flag,ip = :ip WHERE ID = :id"
//AS服务器配置操作语句
#define QUERY_AS_CONFIG "SELECT ID,IP,PORT,SERVER_CERT_NAME,AP_CERT_NAME,ROOT_CERT_NAME,CERT_PWD  FROM AS_CONFIG"
//SNMP服务器配置操作语句
#define INSERT_SNMP_CONFIG "INSERT INTO SNMP_CONFIG (SNMP_READ_PW,SNMP_READ_WRITE_PW,TRAP_IP1,TRAP_IP2,TRAP_PW,SNMP_READ_WRITE_PORT,TRAP_PORT) VALUES (:snmp_read_pw,:snmp_read_write_pw,:trap_ip1,:trap_ip2,:trap_pw,:snmp_read_write_port,:trap_port)"
#define QUERY_SNMP_CONFIG "SELECT SNMP_READ_PW,SNMP_READ_WRITE_PW,TRAP_IP1,TRAP_IP2,TRAP_PW,SNMP_READ_WRITE_PORT TRAP_PORT FROM SNMP_CONFIG"
#define DELETE_SNMP_CONFIG "DELETE FROM SNMP_CONFIG WHERE ID = :id"
#define UPDATE_SNMP_CONFIG "UPDATE SNMP_CONFIG SET SNMP_READ_PW = :snmp_read_pw,SNMP_READ_WRITE_PW = :snmp_read_write_pw,TRAP_IP1 = :trap_ip1,TRAP_IP2 = :trap_ip2,TRAP_PW = :trap_pw,SNMP_READ_WRITE_PORT = :snmp_read_write_port,TRAP_PORT =  :trap_port WHERE ID = :id"
//AP版本信息操作语句
#define INSERT_VERSION_INFO "INSERT INTO VERSION_INFO (HARDWARE_VERSION,MANUFACTURER,SOFTWARE_VERSION) VALUES (:hardware_version,:manufacturer,:software_version)"
#define QUERY_VERSION_INFO "SELECT ID,HARDWARE_VERSION,MANUFACTURER,DEVICE_MODEL FROM VERSION_INFO"
#define DELETE_VERSION_INFO "DELETE FROM VERSION_INFO WHERE ID = :id"
#define UPDATE_VERSION_INFO "UPDATE VERSION_INFO SET HARDWARE_VERSION = :hardware_version,MANUFACTURER = :manufacturer,SOFTWARE_VERSION = :software_version WHERE ID = :id"
#define QUERY_VERSION_INFO_CON "SELECT id FROM VERSION_INFO WHERE HARDWARE_VERSION = '%s' AND MANUFACTURER = '%s' AND DEVICE_MODEL = '%s' " 
//热备操作语句
#define INSERT_HOTBAK_CONFIG "INSERT INTO HOTBAK_CONFIG (START_IP,END_IP,MANAGE_IP,BAK_MANAGE_IP) VALUES (:start_ip,:end_ip,:manage_ip,:bak_manage_ip)"
#define QUERY_HOTBAK_CONFIG "SELECT ID,START_IP,END_IP,MANAGE_IP,BAK_MANAGE_IP FROM HOTBAK_CONFIG"
#define DELETE_HOTBAK_CONFIG "DELETE FROM HOTBAK_CONFIG WHERE ID = :id"
#define UPDATE_HOTBAK_CONFIG "UPDATE HOTBAK_CONFIG SET START_IP = :start_ip,END_IP = :end_ip,MANAGE_IP = :manage_ip,BAK_MANAGE_IP = :bak_manage_ip WHERE ID = :id"

//NTP SERVER操作语句
#define QUERY_NTP_SERVER_CONFIG "SELECT ID,SWITCH_FLAG FROM NTP_SERVER_CONFIG"
//NTP CLIENT操作语句
#define QUERY_NTP_CLIENT_CONFIG "SELECT ID,SWITCH_FLAG,IP1, SYN_TIME,FLAG FROM NTP_CLIENT_CONFIG"

//路由器操作语句
#define QUERY_ROUTE_CONFIG "SELECT ID,DEST_IP,NETMASK,NEXT_HOP FROM ROUTE_CONFIG"
//MAC过滤操作语句
#define QUERY_MAC_FILTER "SELECT ID,MAC FROM MAC_FILTER"
//日志操作语句
#define QUERY_SYSLOG_CONFIG "SELECT ID,LEVEL,IP1,IP2,IP1_PORT,IP2_PORT FROM SYSLOG_CONFIG"
//网口信息操作语句
#define QUERY_NET_INFO "SELECT ID,NET_NAME,IP,NETMASK,GATEWAY FROM NET_INFO"
//射频基本信息操作语句
#define QUERY_RADIO_BASE "SELECT ID,RADIO_ID,SWITCH_FLAG,POWER_MODE,POWER,MODE,RATE,N_RATE,MASK,CHANNEL_WIDTH,GUARD_INTERVAL,MPDU,MSDU,N_MODE  FROM RADIO_BASE"
//射频高级配置操作语句
#define QUERY_RADIO_ADVANCE "SELECT ID,ISOLIATE,IGMP_SNOOPING,PRE_AUTH,UP_LINK_CHECK,ACTION,ACTION_IP,NTP_IP,SYN_TIME FROM RADIO_ADVANCE"
//背景扫描配置操作语句
#define QUERY_SCAN_CONFIG "SELECT ID,RADIO_ID,CHAN,SWITCH_FLAG,PERIOD FROM SCAN_CONFIG"
//信道配置操作语句
#define QUERY_CHAN_CONFIG "SELECT ID,RADIO_ID,CHAN_AUTO,CHAN_AUTO_MODE,CHAN_AUTO_TIME,MIN_RSSI FROM CHAN_CONFIG"
//负载均衡配置操作语句
#define QUERY_LOAD_BALANCE "SELECT ID,SWITCH_FLAG,BALANCE_TYPE,USER_START_MAX,USER_DIFF,USER_MAX FROM LOAD_BALANCE"
//CAPWAP保活配置操作语句
#define QUERY_CAPWAP_TIMER_CONFIG "SELECT ID,KEEP_ALIVE,BROADCAST_PERIOD FROM CAPWAP_TIMER_CONFIG"
//DOWNLOAD配置查询
#define QUERY_DOWNLOAD_CONFIG "SELECT ID,IP,PORT,USERNAME,PWD,VERSION_NAME FROM DOWNLOAD_CONFIG"

#define QUERY_STA_INFO "SELECT name,id,curDate FROM testTable ORDER BY 1"
#define INSERT_STA_ITEM "INSERT INTO STA_ITEM (AP_MAC,BSSID,MAC,SSID,START_TIME) VALUES (:ap_mac,:bssid,:mac,:ssid,CURRENT_TIMESTAMP)  "
#define CHECK_STA_ITEM "SELECT COUNT(*) FROM STA_ITEM WHERE MAC = :mac "
#define UPDATE_STA_ITEM "UPDATE STA_ITEM SET START_TIME = CURRENT_TIMESTAMP WHERE MAC = :mac "
#define DELETE_STA_ITEM "DELETE   FROM STA_ITEM WHERE MAC=:mac "



int get_ap_accord_mac(DB_CONTENT_T *pdb_content,char *mac,AP_ITEM_T * pApItem);
int get_ap_policy_accord_gid(DB_CONTENT_T *pdb_content,int gid,PPOLICY_ITEM_T policyItems);
int get_ap_wlan_accord_gid(DB_CONTENT_T *pdb_content,int gid,PWLAN_ITEM_T wlanItems);
int get_ap_wlan_security(DB_CONTENT_T *pdb_content,int id,PWLAN_SECURITY_POLICY_T wlanSecurityPolicys);
int get_radius_config(DB_CONTENT_T *pdb_content,PRADIUS_CONFIG_T  radiusConfigInfos);
int get_as_config(DB_CONTENT_T *pdb_content,PAS_CONFIG_T asConfigInfos);
int get_hotbak_config(DB_CONTENT_T *pdb_content,PHOTBAK_CONFIG_T HotbakConfigs);
int get_ntp_config(DB_CONTENT_T *pdb_content,PNTP_CONFIG_T ntpConfigInfos);
int get_snmp_config(DB_CONTENT_T *pdb_content,PSNMP_CONFIG_T snmpConfigInfos);
int get_version_config(DB_CONTENT_T *pdb_content,PVERSION_INFO_T VersionInfos);
int get_ntp_server_config(DB_CONTENT_T *pdb_content,PNTP_SERVER_CONFIG_T NtpServerConfigs);
int get_ntp_client_config(DB_CONTENT_T *pdb_content,PNTP_CLIENT_CONFIG_T NtpClientConfigs);
int get_route_config(DB_CONTENT_T *pdb_content,PROUTE_CONFIG_T  RouteConfigs);
int get_mac_filter(DB_CONTENT_T *pdb_content,PMAC_FILTER_T MacFilters);
int get_syslog_config(DB_CONTENT_T *pdb_content,PSYSLOG_CONFIG_T SyslogConfigs);
int get_net_info(DB_CONTENT_T *pdb_content,PNET_INFO_T NetInfos);
int get_radio_base(DB_CONTENT_T *pdb_content,PRADIO_BASE_T Radio_bases);
int get_radio_advance(DB_CONTENT_T *pdb_content,PRADIO_ADVANCE_T RadioAdvances);
int get_scan_config(DB_CONTENT_T *pdb_content,PSCAN_CONFIG_T ScanConfigs );
int get_chan_config(DB_CONTENT_T *pdb_content,PCHAN_CONFIG_T ChanConfigs);
int get_load_balance(DB_CONTENT_T *pdb_content,PLOAD_BALANCE_T LoadBalances);
int get_capwap_timer_config(DB_CONTENT_T *pdb_content,PCAPWAP_TIMER_CONFIG_T CapwapTimerConfigs);
 int get_download_config(DB_CONTENT_T *pdb_content,PDOWNLOAD_CONFIG_T downloadConfigInfos );
int insert_invalid_ap_item(DB_CONTENT_T *pdb_content,INVALID_AP_ITEM_T pAP);
int check_ap_config(DB_CONTENT_T *pdb_content,PCHECK_INFO_T pCheckInfo);
int insert_sta_item(DB_CONTENT_T *pdb_content,STA_ITEM_T psta_item);
int delete_sta_item(DB_CONTENT_T *pdb_content,STA_ITEM_T psta_item);
int insert_no_group_ap_item(DB_CONTENT_T *pdb_content,INVALID_AP_ITEM_T pAP);
 
int update_ap_online_time_mac(char *mac);


//yzc
extern  int update_ap_item_mac(DB_CONTENT_T *pdb_content,PAP_ITEM_T pItem);
extern  int get_invalid_ap_switch(DB_CONTENT_T *pdb_content);
extern  int get_wlan_user_mode(DB_CONTENT_T *pdb_content,char apMac[MAC_LEN],int wlanID);

#endif

